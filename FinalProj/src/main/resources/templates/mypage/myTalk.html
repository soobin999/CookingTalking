<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title id='pageTitle'>마이페이지(정민)</title>
<style type="text/css"></style>
</head>
<body>
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<!-- <script src="/js/mypage.js"></script> -->

	<!-- 사진 및 계정 정보 -->


	<div id="myPageMain">

		<div th:class="uploadPicOfUser">
			<button
				onclick="window.open('/mypage/userPic','myPic','width=300px, height=300px, location=no, status=no, scrollbars=no');">사진변경하기</button>
		</div>
		<a href="/userModify.html">회원 정보 수정</a>

		<div class="myMenu">
			<button onclick="myRecipe()">레시피</button>
			<button onclick="myFrequent()">즐겨찾기</button>
			<button onclick="myActivity()">활동</button>
			<button onclick="myInquiry()">문의 사항</button>
		</div>

		<div id="myRecipe">
			<button onclick="myActivity()">내가 작성한 글</button>
			<button onclick="myCom()">내가 작성한 댓글</button>

			<form onsubmit="return false">
				<input type="text" onsubmit="return false" title="토크검색"
					id="talkSearchInMy" name="talkSearchInMy" placeholder="토크를 검색하세요"
					onkeypress="enterkey(event);">
				<button type="button" onclick="searchButtonClick();"
					id="btnTalkSearchInMy">검색</button>
			</form>

		</div>

		<div th:id="myActivity">
			<div th:id="myTalkMain">
				<table>
					<tbody>
						<!-- 		<div class="myRecipeIng_img">레시피 사진</div>
		<div class="myRecipeIng_title">레시피 제목</div> -->
						<!-- 	<td id="talkCont" name="talkCont"></td>
	<td id="talkDate" name="talkDate"></td> -->

						<tr th:each="myTalk : ${myTalk}">
							<td><a
								th:href="@{/talk/detail/{talkCode}(talkCode=${myTalk.talkCode})}"
								class="" th:value="${myTalk.talkCont}"
								th:text=${myTalk.talkCont}></a></td>
							<td class="" th:value="${myTalk.talkDate}"
								th:text=${myTalk.talkDate}></td>

						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>


	<script>
		function formatDate(date) {
			var d = new Date(date), 
			month = '' + (d.getMonth() + 1),
			day = '' + d.getDate(), year = d.getFullYear();
			
			if (month.length < 2)	month = '0' + month;
			if (day.length < 2)		day = '0' + day;
			
			return [ year, month, day ].join('-');
		}
		 Date.prototype.yyyymmdd = function() {
		      var yyyy = this.getFullYear().toString();
		      var mm = (this.getMonth() + 1).toString();
		      var dd = this.getDate().toString();
		      return  yyyy + "-" + (mm[1] ? mm : "0" + mm[0]) + "-" + (dd[1] ? dd : "0" + dd[0]);
		  }
		 
		$(document).ready(function() {

			/*토크 검색하기 via 엔터*/
			$('#talkSearchInMy').on('keydown', function(event) {
				if (event.keyCode == 13) {
					myTalkSearch();
					event.preventDefault();
				}
				;
			});
		});

		$('#btnTalkSearchInMy').on('click', function() {
			myTalkSearch();
		});

		function myTalkSearch() {
			var key = $('#talkSearchInMy').val(); /*토크 검색 키워드*/

			$
					.ajax({
						type : "POST",
						url : "/searchMyTalk",
						data : {
							talkCont : key
						},
						success : function(data) {
							console.log("==============" + data);
							var searchedTalk;
							var result = $('#myActivity');
							$('#myTalkMain').remove();
							$
									.each(
											data,
											function(index, value) {
												console.log(data[index].talkCode);
												
												var unix_date = (new Date(data[index].talkDate)).yyyymmdd();
												console.log(unix_date);
												/* 			            
												 var timestamp = 1476508607 * 1000; */
												
												/* 			            var date = moment(unix_date).format("YYYY-MM-DD");
												 console.log(date); */

												/*  			            var year = date.getYear().toString();
												 var month = (date.getMonth()+1).toString();
												 var day = date.getDate().toString();  */

												searchedTalk = '<tr id="myTalkMain"><td>'
														+ '<a href="/talk/detail/'
			            + data[index].talkCode + '">'
														+ data[index].talkCont
														+ '</a>'
														+ '</td><td>'
														+ unix_date
														+ '</td></tr><br>'
												console.log("data.talkCont:"
														+ value.talkCont);
												console.log("data.talkDate:"
														+ value.talkDate);
												result.append(searchedTalk);
											});
						},
						error : function() {
							alert("TalkSearch Error");
						}
					});
		}
	</script>


</body>

</html>