<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title id='pageTitle'>마이페이지(정민)</title>
<style type="text/css"></style>
</head>
<body>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="/js/mypage.js"></script>

	<!-- 사진 및 계정 정보 -->
	
	<div id="mypageMain">
	<div th:class="uploadPicOfUser">
				<button onclick="window.open('/mypage/userPic','myPic','width=300px, height=300px, location=no, status=no, scrollbars=no');">사진변경하기</button>
		</div>     
	<a href="/userModify.html">회원 정보 수정</a>
	
	<div class="myMenu">
	<button onclick="myRecipe()">레시피</button>
	<button onclick="myFrequent()">즐겨찾기</button>
	<button onclick="myActivity()">활동</button>
	<button onclick="myInquiry()">문의 사항</button>
	</div>
	
	<div id="myFrequent">
		<button onclick="myFrequent()">팔로우</button>
		<button onclick="myScraped()">스크랩한 레시피</button>
			<form onsubmit="return false">
				<input type="text" onsubmit="return false" title="쉐프검색"
					id="scrapedSearchInMy" name="scrapedSearchInMy" placeholder="레시피를 검색하세요"
					onkeypress="enterkey(event);">
				<button type="button" onclick="myScrapSearch();" id="btnScrapedSearchInMy">검색</button>
			</form>
		</div>

	<div th:id="myFrequentSub">
	<div th:id="myScrapededMain">
	<table>
	<tbody>
<!-- 		<div class="myRecipeIng_img">레시피 사진</div>
		<div class="myRecipeIng_title">레시피 제목</div> -->
	
	
	<tr th:each="myScraped : ${myScraped}">
		<td> <a th:href="@{/recipe/view(rcpCode=${myScraped.rcpCode})}" th:value="${myScraped.rcpPic}" th:text=${myScraped.rcpPic}></a></td>
		<td> <a th:href="@{/recipe/view(rcpCode=${myScraped.rcpCode})}" th:value="${myScraped.rcpTitle}" th:text=${myScraped.rcpTitle}></a></td>
		<td th:value="${myScraped.scrapDate}" th:text=${myScraped.scrapDate}></td>
	</tr>
	</tbody>
	</table>
	</div>
	</div>
	</div>
	
	<script>
	
	 Date.prototype.yyyymmdd = function() {
	      var yyyy = this.getFullYear().toString();
	      var mm = (this.getMonth() + 1).toString();
	      var dd = this.getDate().toString();
	      return  yyyy + "-" + (mm[1] ? mm : "0" + mm[0]) + "-" + (dd[1] ? dd : "0" + dd[0]);
	  }
	
	$(document).ready(function(){
		   $('#scrapedSearchInMy').on('keydown', function(event){
			      if(event.keyCode == 13){
			         myScrapSearch();
			         event.preventDefault();
			      }
			   });
		});
	
	
	function searchButtonClick(){


		   $('#btnScrapedSearchInMy').on('click', function(){
		      myScrapSearch();
		   });

		}

	function myScrapSearch(){
		   var key = $('#scrapedSearchInMy').val(); /*스크랩 검색 키워드*/

		   $.ajax({
		      type : "POST",
		      url : "/searchMyScrap",
		      data : {rcpTitle : key},
		      success : function(data) {
		         var searchedScrap = new Array();
		         var result = $('#myFrequentSub');
		         var a,b;
		         removeFunc();
		         
		         a='<tr id="myScrapededMain"><td>'
		         b='</td></tr><br>'
		         
		         $('#myScrapededMain').remove();
		         $.each(data, function(index, value){
		            
		       	  var scrap_date = (new Date(data[index].scrapDate)).yyyymmdd();
		    	  console.log(scrap_date);
		            searchedScrap[index] =
		     		'<a href="/recipe/view?rcpCode='
		            + data[index].rcpCode + '">'
		            + data[index].rcpPic + '</a>'
		            + '</td><td>' + '<a href="/recipe/view?rcpCode=' 
		            + data[index].rcpCode + '">'
		            + data[index].rcpTitle + '</a>' 
		            + '</td><td>' + scrap_date
		        
		            console.log("data.rcpTitle:"+value.rcpTitle);
		            console.log("data.scrapDate:"+scrap_date);
		         });
		            result.append(a+searchedScrap+b);
		      },
		      error : function(){
		         alert("myScrapSearch Error");
		      }
		   });
		}
	
	function removeFunc(){
		console.log("removeFunc");
		$('#myTalkMain').remove();
	}
	
	</script>
	
	
</body>
</html>